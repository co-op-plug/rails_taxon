<% form_object = default_form_object(@entity, index: params[:index]) %>

<% if @node.children.present? %>
  var template = '<%= j(render partial: 'outer_options', locals: { f: form_object, node: @node.children.build }) %>'
  $('#<%= params[:node_type].underscore %>_wrapper_<%= @node.depth %>').nextAll().remove();
  $('#<%= form_object.wrapper_input_id(params[:method]).gsub('(', '\\\\(').gsub(')', "\\\)") %>').after(template);
  remote_js_load(<%= raw remote_js_load %>)
<% else %>
  if ($('#<%= form_object.wrapper_input_id(params[:node_type].underscore) %>').next().length > 0) {
    $('#<%= form_object.wrapper_input_id(params[:node_type].underscore) %>').nextAll().remove();
  }
<% end %>
